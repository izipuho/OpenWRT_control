button_card_templates:
  openwrt_updater:
    variables:
      ip: null
    show_name: false
    show_icon: true
    show_state: false
    tap_action:
      action: url
      url_path: |
        [[[
          let e = 'text.ip_address_' + variables.ip;
          let ip = states[e]?.state;
          return 'http://' + ip;
        ]]]
    styles:
      card:
        - padding: 0
        - margin: 0
        - border: 0
        - box-shadow: 0
      grid:
        - grid-template-areas: '"name name name name i" "update reboot force versions versions"'
        - grid-template-columns: 2fr 1fr 1fr 1fr 1fr
        - grid-template-rows: auto
      icon:
        - top: 0
        - right: 0
        - position: absolute
        - opacity: 50%
        - transform: scale(5)
      custom_fields:
        name:
          - text-align: left
          - font-size-adjust: 0.5
          - padding: 3px
        versions:
          - text-align: right
          - font-size-adjust: 0.4
          - padding: 3px
    entity: |
      [[[ return 'binary_sensor.status_' + (variables.ip || 'unknown_ip') ]]]
    custom_fields:
      name: |
        [[[
          let n = 'text.device_name_' + variables.ip;
          let i = 'text.ip_address_' + variables.ip;
          let name = states[n]?.state
          let ip = states[i]?.state
          return `<b>${name}</b><br>${ip}`;
        ]]]
      reboot:
        card:
          type: button
          entity: |
            [[[ return 'button.reboot_' + variables.ip ]]]
          show_name: true
          show_icon: true
          name: R
          card_mod:
            style: |
              ha-card {
                border: none;
                font-size-adjust: 0.3;
              }
      force:
        card:
          type: button
          entity: |
            [[[ return 'switch.force_update_' + variables.ip ]]]
          show_name: true
          show_icon: true
          name: F
          card_mod:
            style: |
              ha-card {
                border: none;
                font-size-adjust: 0.3;
              }
      update:
        card:
          type: button
          entity: |
            [[[ return 'update.firmware_' + variables.ip ]]]
          show_name: false
          show_icon: true
          icon_height: 50px
          card_mod:
            style: |
              ha-card {
                border: none;
              }
      versions: |
        [[[
          let e = 'update.firmware_' + variables.ip;
          let a = states[e]?.attributes;
          return `<b>C:</b> ${a?.installed_version || 'N/A'}<br><b>L:</b> ${a?.latest_version || 'N/A'}`;
        ]]]
